/*! @name videojs-seek-chapter @version 0.1.0 @license MIT */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],t):(e=e||self).videojsSeekChapter=t(e.videojs)}(this,function(e){"use strict";var t=(e=e&&e.hasOwnProperty("default")?e.default:e).getPlugin("plugin"),r={displayFullChapter:!1,chapterDisplayLength:10},o=e.registerPlugin||e.plugin,i=function(t){var o,i;function n(o,i){var n;return(n=t.call(this,o)||this).chapters=[],n.regTimmer=/^(?:(?:([01]?\d|2[0-3]):)?([0-5]?\d):)?([0-5]?\d)$/,n.options=e.mergeOptions(r,i),n.player.ready(function(){n.player.addClass("vjs-seek-chapter"),n.chapterCues=[]}),n.player.on("loadedmetadata",function(){n.controlBar=n.player.getChild("controlBar"),n.progressControl=n.controlBar.getChild("progressControl"),n.seeker=n.progressControl.getChild("SeekBar"),n.mouseDisplay=n.seeker.getChild("MouseTimeDisplay"),n.tooltip=n.mouseDisplay.getChild("TimeTooltip"),n.duration=n.player.duration(),n.cues;for(var e,t=o.textTracks(),r=0;t.length>r;r++)"chapters"===t[r].kind&&(e=t[r]);n.chapterCues=e.cues,new Promise(function(e,t){var r=setInterval(function(){n.cues?(clearInterval(r),e(!0)):n.cues=n.chapterCues.cues_},250)}).then(function(){return n.addChapterToProgressBar()})}),n}i=t,(o=n).prototype=Object.create(i.prototype),o.prototype.constructor=o,o.__proto__=i;var a=n.prototype;return a.addChapterToProgressBar=function(){var e=this;this.cues.forEach(function(t){var r=document.createElement("div"),o=(t.startTime+1)/e.duration*100,i=t.endTime/e.duration*100;r.className="chapter-bar",r.setAttribute("start",t.startTime),r.setAttribute("end",t.endTime),r.setAttribute("text",t.text),r.style.left=o+"%",r.style.width=e.options.displayFullChapter?i-o+"%":e.options.chapterDisplayLength+"px",e.chapters.push(r),e.seeker.el().appendChild(r)}),this.updateToolTip()},a.updateToolTip=function(){var e=this,t=this.tooltip.el();new MutationObserver(function(r){var o=r,i=Array.isArray(o),n=0;for(o=i?o:o[Symbol.iterator]();;){var a;if(i){if(n>=o.length)break;a=o[n++]}else{if((n=o.next()).done)break;a=n.value}"childList"==a.type&&e.chapters.forEach(function(r){var o=r.getBoundingClientRect(),i=e.mouseDisplay.el().getBoundingClientRect();!(o.right<i.left||o.left>i.right||o.bottom<i.top||o.top>i.bottom)&&e.regTimmer.test(t.innerText)&&(t.innerText=t.innerText+" "+r.getAttribute("text"))})}}).observe(t,{childList:!0})},a.hmsToSecondsOnly=function(e){for(var t=e.split(":"),r=0,o=1;t.length>0;)r+=o*parseInt(t.pop(),10),o*=60;return r},n}(t);return i.defaultState={},i.VERSION="0.1.0",o("seekChapter",i),i});
