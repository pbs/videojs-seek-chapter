/*! @name videojs-seek-chapter @version 0.1.0 @license MIT */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],t):(e=e||self).videojsSeekChapter=t(e.videojs)}(this,function(e){"use strict";var t=(e=e&&e.hasOwnProperty("default")?e.default:e).getPlugin("plugin"),r={displayFullChapter:!1,chapterDisplayLength:10},o=e.registerPlugin||e.plugin,i=function(t){var o,i;function a(o,i){var a;return(a=t.call(this,o)||this).chapters=[],a.regTimmer=/^(?:(?:([01]?\d|2[0-3]):)?([0-5]?\d):)?([0-5]?\d)$/,a.options=e.mergeOptions(r,i),a.player.ready(function(){a.player.addRemoteTextTrack({kind:"chapters",src:"src/chapters.vtt",label:"Chapters",default:!1},!0),a.player.addClass("vjs-seek-chapter"),a.chapterCues=[]}),a.player.on("loadedmetadata",function(){if(a.controlBar=a.player.getChild("controlBar"),a.progressControl=a.controlBar.getChild("progressControl"),a.seeker=a.progressControl.getChild("SeekBar"),a.mouseDisplay=a.seeker.getChild("MouseTimeDisplay"),a.mouseDisplay){a.tooltip=a.mouseDisplay.getChild("TimeTooltip"),a.duration=a.player.duration(),a.cues;for(var e,t=o.textTracks(),r=0;t.length>r;r++)"chapters"===t[r].kind&&(e=t[r]);a.chapterCues=e.cues,new Promise(function(e,t){var r=setInterval(function(){a.cues?(clearInterval(r),e(!0)):a.cues=a.chapterCues.cues_},250)}).then(function(){return a.addChapterToProgressBar()})}}),a}i=t,(o=a).prototype=Object.create(i.prototype),o.prototype.constructor=o,o.__proto__=i;var n=a.prototype;return n.addChapterToProgressBar=function(){var e=this;this.cues.forEach(function(t){var r=document.createElement("div"),o=(t.startTime+1)/e.duration*100,i=t.endTime/e.duration*100;r.className="chapter-bar",r.setAttribute("start",t.startTime),r.setAttribute("end",t.endTime),r.setAttribute("text",t.text),r.style.left=o+"%",r.style.width=e.options.displayFullChapter?i-o+"%":e.options.chapterDisplayLength+"px",e.chapters.push(r),e.seeker.el().appendChild(r)}),this.updateToolTip()},n.updateToolTip=function(){var e=this,t=this.tooltip.el();new MutationObserver(function(r){var o=r,i=Array.isArray(o),a=0;for(o=i?o:o[Symbol.iterator]();;){var n;if(i){if(a>=o.length)break;n=o[a++]}else{if((a=o.next()).done)break;n=a.value}"childList"===n.type&&e.chapters.forEach(function(r){var o=r.getBoundingClientRect(),i=e.mouseDisplay.el().getBoundingClientRect();!(o.right<i.left||o.left>i.right||o.bottom<i.top||o.top>i.bottom)&&e.regTimmer.test(t.innerText)&&(t.innerText=t.innerText+" "+r.getAttribute("text"))})}}).observe(t,{childList:!0})},n.hmsToSecondsOnly=function(e){for(var t=e.split(":"),r=0,o=1;t.length>0;)r+=o*parseInt(t.pop(),10),o*=60;return r},a}(t);return i.defaultState={},i.VERSION="0.1.0",o("seekChapter",i),i});
